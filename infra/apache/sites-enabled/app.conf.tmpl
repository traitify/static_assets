# we use three different entries for redirects.  We could use mod_rewrite, but this is very little in the way of extra
# code, and avoids that overhead.
<VirtualHost {{ env "NOMAD_ADDR_http" }} >
  ServerName    *
  DocumentRoot  {{ env "NOMAD_TASK_DIR" }}/{{ env "APP_NAME" }}

</VirtualHost>

<VirtualHost {{ env "NOMAD_ADDR_https" }} >
  ServerName      *
  DocumentRoot  {{ env "NOMAD_TASK_DIR" }}/{{ env "APP_NAME" }}
  DirectoryIndex  index.html index.php index.php5

  SSLEngine       On
  #SSLProxyEngine  On
  SSLCertificateFile /etc/apache2/ssl/ssl.crt_key
  # we include the certkey in the certificate file above. It's not recommended, but it works fine, and is much easier when
  # using nomad to template things out
  #SSLCertificateKeyFile /etc/apache2/ssl/ssk.key

  # make sure to set an expiration or google doesn't like us
  ExpiresActive On
  ExpiresDefault "access plus 12 months"
  ExpiresByType text/html "access plus 1 month"

  # add in some config for fastly
  Header set Surrogate-Control max-age=3600,stale-if-error=86400
  Header set Cache-Control stale-while-revalidate=60

</VirtualHost>

<Directory {{ env "NOMAD_TASK_DIR" }}/{{ env "APP_NAME" }} >
  Options -Indexes +FollowSymLinks
  AllowOverride All

  Order allow,deny
  Allow from all
  Require all granted

</Directory>

